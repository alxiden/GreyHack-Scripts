crypto = include_lib("/lib/crypto.so")

shell = get_shell("root","HappyLittleFis")

computer = shell.host_computer()

// Step 1: run chmod -R o-rwx /

print("Please run chmod -R o-rwx /")

// Step 2: Get second WiFi

wifi = computer.wifi_networks("wlan0")

for network in wifi
	info = network.split(" ")
	percent = info[1].replace("%","")
	num = percent.to_int()
	//print(num)
	if num >= 70 then
		print("Netowrk Found")
		monitor = crypto.airmon("start","wlan0")
		crack_file = crypto.aireplay(info[0],info[2], 10000)
		//print(crack_file)
		result = crypto.aircrack(home_dir + "/file.cap")
		print(info[2] + ":" + result)
	end if
end for
randomIp = function()
    while true
        ip = floor((rnd * 255) + 1) + "." + floor((rnd * 255) + 1) + "." + floor((rnd * 255) + 1) + "." + floor((rnd * 255) + 1)
        if not is_valid_ip(ip) then continue
        if is_lan_ip(ip) then continue
        return ip
    end while
end function

getRouter = function(ip)
	router = get_router(ip)
	if not router then router = get_switch(ip)
	if not router then return null
	return router
end function

hasRepoService = function(router)
    for lanIp in router.devices_lan_ip
        ports = router.device_ports(lanIp)
        for port in ports
            if router.port_info(port).split(" ")[0] == "repository" then return true
        end for
    end for
    return null
end function

main = function()
    while true
        ip = randomIp
        router = getRouter(ip)
        if not router then continue
        if not hasRepoService(router) then continue
        exit(ip)
    end while
end function
main
