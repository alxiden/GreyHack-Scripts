metaxploit = include_lib("/lib/metaxploit.so")
cryptools = include_lib("/lib/crypto.so")

value_tidy = []
action = params[0]

if params.len == 1 and action != "-h" then
	print("Please add an IP address or use -h for the help guide")
	exit()
else if params.len == 2 then
	ip_address = params[1]
else if params.len == 3 then
	ip_address = params[1]
	port = params[2].to_int
else
	port = null
end if

if params.len == 2 then
	ip_address = params[1]
end if 

crack = function(hash = ip_address)
	plain = cryptools.decipher(password)
	print(plain)
end function


scanner = function()
	if action == "-sr" then
		net_session = metaxploit.net_use(ip_address)
	else
		net_session = metaxploit.net_use(ip_address, port)
	end if

	if not net_session then exit("Error: No Connection")
	
	metaLib = net_session.dump_lib //gets the libary for scanning
	print("--------Scanning--------")
	scans = metaxploit.scan(metaLib) //scans the libary
	for i in scans
		value_tidy = []
		req= []
		memory_scan = metaxploit.scan_address(metaLib, i)
		value = memory_scan.remove("decompiling source...")
		value = value.remove("searching unsecure values...")
		value = value.replace("\n","")
		//print(value)
		values = value.split("\.")
		//print(values)
		for v in values
			if v == "" then
				values.remove(values.indexOf(v))
			else if v.len > 11 then
				val = v.remove("Unsafe check: loop in array ")
				val = val.remove("Unsafe check: string copy in ")
				val = val.remove(" Buffer overflow")
				val = val.remove("</b>")
				//print("V =" + val)
				if val != "" then
					value_tidy.push(val)
				end if
			end if
			
		end for
		print(i)
		print(value_tidy[0])
		for num in range(1,value_tidy.len - 1)
			print(value_tidy[num])
		end for
		print("------------------------------------")
	end for
end function


if action == "-h" then
	print("The command should be starstream [action] [ip address] [port]")
	print("-h	Help")
	print("-c	Crack Password")
	print("-s	Scan Host")
	print("-sr	Scan Router")
end if

if action == "-sr" or action == "-s" then 
	scanner
else if action == "-c" then
	crack
end if
	
		


